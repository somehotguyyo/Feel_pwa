<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="default" />
  <meta name="theme-color" content="#f6f6f6" />

  <link rel="manifest" href="manifest.json">
  <link rel="apple-touch-icon" href="icons/Icon-192.png">

  <title>feel Â· é€‰ä½ çš„é¥­</title>

  <style>
    :root{
      --bg:#f6f6f6;
      --card:rgba(255,255,255,.92);
      --stroke:rgba(0,0,0,.07);
      --text:#111;
      --muted:rgba(0,0,0,.55);
      --shadow:0 18px 60px rgba(0,0,0,.10);
      --shadow2:0 10px 26px rgba(0,0,0,.08);
      --r:28px;
      --ease:cubic-bezier(.2,.9,.2,1);
    }
    *{box-sizing:border-box;}
    html,body{height:100%;}
    body{
      margin:0;
      font-family:-apple-system,BlinkMacSystemFont,"SF Pro Display","SF Pro Text","PingFang SC","Hiragino Sans GB","Microsoft YaHei",Arial,sans-serif;
      color:var(--text);
      background:
        radial-gradient(900px 520px at 50% -140px, rgba(29,116,255,.16), transparent 60%),
        radial-gradient(760px 460px at 12% 18%, rgba(255,153,0,.10), transparent 60%),
        radial-gradient(760px 520px at 88% 16%, rgba(0,0,0,.05), transparent 60%),
        var(--bg);
      -webkit-font-smoothing:antialiased;
      overflow:hidden;
    }

    /* å›ºå®šå·¦ä¸Šè¿”å› */
    .topLeft{
      position:fixed;
      top: calc(12px + env(safe-area-inset-top));
      left: 12px;
      z-index:30;
      display:none;
    }
    .backPill{
      border:1px solid var(--stroke);
      background:rgba(255,255,255,.88);
      border-radius:999px;
      padding:10px 14px;
      box-shadow:var(--shadow2);
      font-weight:800;
      color:rgba(0,0,0,.72);
      user-select:none;
      -webkit-tap-highlight-color:transparent;
      cursor:pointer;
    }
    .backPill:active{transform:scale(.98);}

    /* HOME */
    .home{
      height:100%;
      display:flex;
      flex-direction:column;
      align-items:center;
      justify-content:flex-start;
      padding: calc(56px + env(safe-area-inset-top)) 16px 16px;
      overflow:auto;
    }
    .hero{
      width:min(860px,100%);
      text-align:center;
      margin-top: 28px;
      margin-bottom: 8px;
    }
    .title{
      margin:0;
      font-weight:860;
      font-size:34px;
      letter-spacing:-.02em;
      line-height:1.08;
      font-family:"Snell Roundhand","Bradley Hand","Segoe Script",-apple-system,"PingFang SC",sans-serif;
    }
    .subtitle{
      margin:10px 0 0;
      font-size:15.5px;
      color:var(--muted);
      line-height:1.55;
    }

    /* âœ… é¦–é¡µé€‰é¡¹æ•´ä½“å¾€ä¸‹ï¼šåªæ”¹è¿™ä¸ªæ•° */
    .grid{
      width:min(860px,100%);
      margin-top: 80px; /* æ›´ä¸‹ */
      display:grid;
      grid-template-columns:repeat(2,minmax(0,1fr));
      gap:14px;
      padding-bottom: 18px;
    }
    @media (max-width:390px){ .grid{grid-template-columns:1fr;} }

    .stateBtn{
      border:1px solid var(--stroke);
      background:var(--card);
      border-radius:22px;
      padding:18px 16px;
      display:flex;
      align-items:center;
      gap:12px;
      min-height:88px;
      box-shadow:var(--shadow2);
      transition:transform .18s var(--ease), box-shadow .18s var(--ease);
      user-select:none;
      -webkit-tap-highlight-color:transparent;
      cursor:pointer;
    }
    .stateBtn:hover{transform:translateY(-2px); box-shadow:var(--shadow);}
    .stateBtn:active{transform:scale(.985);}

    .emojiCircle{
      width:46px;height:46px;
      border-radius:999px;
      display:grid;
      place-items:center;
      background:rgba(0,0,0,.04);
      border:1px solid rgba(0,0,0,.05);
      box-shadow:inset 0 1px 0 rgba(255,255,255,.8);
      font-size:22px;
      flex:0 0 auto;
    }
    .stateText{min-width:0; display:flex; flex-direction:column; gap:4px;}
    .stateName{font-size:16px;font-weight:780;color:#0b3a8a;letter-spacing:-.01em;}
    .stateHint{font-size:12.5px;color:var(--muted);white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}

    .foot{
      width:min(860px,100%);
      text-align:center;
      font-size:12px;
      color:rgba(0,0,0,.35);
      padding: 10px 0 18px;
    }

    /* RESULT */
    .result{
      height:100%;
      display:none;
      padding: calc(56px + env(safe-area-inset-top)) 16px 0;
      overflow:hidden;
    }
    .result.active{display:block;}

    .resultInner{
      height:100%;
      width:min(860px,100%);
      margin: 0 auto;
      display:flex;
      flex-direction:column;
      align-items:center;
      justify-content:flex-start;

      /* âœ… ç»“æœå¡ç‰‡å†å¾€ä¸‹ */
      padding-top: 108px;

      /* âœ… å¡ç‰‡å’ŒæŒ‰é’®æ›´è¿‘ */
      padding-bottom: calc(150px + env(safe-area-inset-bottom));
    }

    .card{
      width:100%;
      border:1px solid var(--stroke);
      background:var(--card);
      border-radius: var(--r);
      padding:18px;
      box-shadow:var(--shadow);
      overflow:hidden;
      animation:fadeIn .22s var(--ease) both;
    }
    @keyframes fadeIn{
      from{opacity:0; transform:translateY(10px);}
      to{opacity:1; transform:translateY(0);}
    }

    .accentBar{
      height:10px;
      border-radius:999px;
      background:linear-gradient(90deg, rgba(29,116,255,.30), rgba(255,153,0,.20));
      margin-bottom:14px;
    }
    .hState{
      margin:0;
      font-size:28px;
      font-weight:900;
      letter-spacing:-.02em;
      display:flex;
      align-items:center;
      gap:10px;
    }
    .hDecide{
      margin:10px 0 0;
      font-size:15px;
      line-height:1.65;
      color:rgba(0,0,0,.70);
      white-space:pre-line;
    }
    .divider{margin:16px 0; height:1px; background:rgba(0,0,0,.06);}
    .labelSmall{
      font-size:12px;
      color:rgba(0,0,0,.45);
      font-weight:900;
      letter-spacing:.02em;
    }
    .dish{
      margin:8px 0 6px;
      font-size:26px;
      font-weight:950;
      letter-spacing:-.02em;
      transition:opacity .14s var(--ease);
    }
    .dishMeta{
      margin:0;
      font-size:13px;
      color:rgba(0,0,0,.52);
      line-height:1.55;
      transition:opacity .14s var(--ease);
    }
    .ritual{
      margin-top:14px;
      border:1px solid rgba(0,0,0,.06);
      background:rgba(0,0,0,.03);
      border-radius:18px;
      padding:14px;
      font-size:14px;
      line-height:1.6;
      color:rgba(0,0,0,.72);
    }
    .ritual b{display:block; margin-bottom:6px;}

    /* âœ… ä¸‰æŒ‰é’®æ•´ä½“ä¸Šç§»ï¼šæ›´é¡ºæ‰‹ */
    .actions{
      position:fixed;
      left:50%;
      transform:translateX(-50%);
      bottom: calc(86px + env(safe-area-inset-bottom));
      width:min(860px, calc(100% - 24px));
      display:none;
      z-index:25;
    }
    .actions.active{display:block;}
    .actionsRow{
      display:flex;
      gap:10px;
      justify-content:center;
      align-items:center;
    }
    .btn{
      border-radius:999px;
      padding:14px 16px;
      font-weight:900;
      border:1px solid var(--stroke);
      background:rgba(255,255,255,.88);
      box-shadow:var(--shadow2);
      cursor:pointer;
      user-select:none;
      -webkit-tap-highlight-color:transparent;
      display:flex;
      justify-content:center;
      align-items:center;
      min-width:0;
      transition:transform .15s var(--ease);
    }
    .btn:active{transform:scale(.985);}
    .btn.primary{
      background:#111;
      color:#fff;
      border-color:rgba(0,0,0,.22);
    }
    .btn.ghost{
      background:rgba(255,255,255,.74);
      color:#0b3a8a;
    }
    .btn.wide{flex:1;}
    .btn.mid{flex:1;}

    /* Toast */
    .toast{
      position:fixed;
      left:50%;
      transform:translateX(-50%);
      bottom: calc(140px + env(safe-area-inset-bottom));
      background:rgba(17,17,17,.92);
      color:#fff;
      padding:10px 14px;
      border-radius:999px;
      font-size:13px;
      box-shadow:0 14px 40px rgba(0,0,0,.22);
      opacity:0;
      pointer-events:none;
      transition:opacity .18s var(--ease), transform .18s var(--ease);
      z-index:99;
      max-width:calc(100% - 24px);
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }
    .toast.show{
      opacity:1;
      transform:translateX(-50%) translateY(-6px);
    }
  </style>
</head>

<body>
  <div class="topLeft" id="topLeft">
    <div class="backPill" id="backBtn">â† å›é¦–é¡µ</div>
  </div>

  <section class="home" id="home">
    <div class="hero">
      <h1 class="title">è¯´ä½ çš„ feelï¼Œé€‰ä½ çš„é¥­</h1>
      <p class="subtitle">ä¸ç”¨æƒ³,æˆ‘æ›¿ä½ åšä¸€ä¸ªå†³å®šã€‚</p>
    </div>

    <div class="grid" id="grid"></div>
    <div class="foot">V1ï¼šå…ˆæŠŠâ€œå†³å®šâ€å’Œâ€œå¯ä¿¡åº¦â€åšå¯¹ï¼›èªæ˜å’Œä¸ªæ€§åŒ–æ”¾åˆ°åæœŸã€‚</div>
  </section>

  <section class="result" id="result">
    <div class="resultInner">
      <div class="card">
        <div class="accentBar" id="accentBar"></div>
        <h2 class="hState" id="stateTitle">ğŸ™‚</h2>
        <p class="hDecide" id="stateDecide">â€¦</p>

        <div class="divider"></div>

        <div class="labelSmall">ä»Šå¤©å°±ç‚¹è¿™ä¸ª</div>
        <div class="dish" id="dishText">â€”</div>
        <p class="dishMeta" id="dishMeta">â€”</p>

        <div class="ritual" id="ritualBox">
          <b>ä»ªå¼æ„Ÿï¼ˆå¯é€‰ï¼‰</b>
          åä¸‹ï¼Œæ‰“å¼€ä¸€é¦–å–œæ¬¢çš„æ­Œï¼ŒæŠŠè¿™ä¸€é¡¿åƒå®Œã€‚
        </div>
      </div>
    </div>
  </section>

  <div class="actions" id="actions">
    <div class="actionsRow">
      <div class="btn primary wide" id="goBtn">å»ç‚¹å¤–å–</div>
      <div class="btn ghost mid" id="swapBtn">æ¢ä¸€ä¸ª</div>
      <div class="btn mid" id="changeBtn">æ¢ä¸ªçŠ¶æ€</div>
    </div>
  </div>

  <div class="toast" id="toast">åƒé¥±äº†å°±å¼€å¿ƒå•¦âœ¨</div>

  <script>
    /**********************
     * tap ç»‘å®šï¼ˆä¿®å¤æŸäº› iPhone click å¤±çµï¼‰
     **********************/
    function bindTap(el, fn){
      if(!el) return;
      el.addEventListener("touchend", (e)=>{
        e.preventDefault();
        fn();
      }, { passive:false });
      el.addEventListener("click", (e)=>{
        e.preventDefault();
        fn();
      });
    }

    /**********************
     * çŠ¶æ€æ–‡æ¡ˆï¼ˆä¸æ”¹ä½ å®šçš„ï¼‰
     **********************/
    const STATE_UI = {
      tired:  { emoji:"ğŸ˜®â€ğŸ’¨", name:"ç´¯",
        decide:"ç°åœ¨è¿™ç§æƒ…å†µï¼Œ\nç›´æ¥åƒä¸€ä»½çƒ­çš„ã€æœ‰è›‹ç™½çš„ä¸»é£Ÿã€‚\nè®©å®ƒæŠŠä½ æ‹‰å›çŠ¶æ€ã€‚",
        accent:"linear-gradient(90deg, rgba(29,116,255,.30), rgba(0,0,0,.06))",
        ritual:"å…ˆå–ä¸¤å£çƒ­çš„ï¼Œå†å¼€åƒã€‚"
      },
      sad:    { emoji:"â˜¹ï¸", name:"å¿ƒæƒ…ä¸å¥½",
        decide:"ç°åœ¨è¿™ç§æƒ…å†µï¼Œ\næ¥ä¸€ä»½ç†Ÿæ‚‰çš„é¥­å’Œèƒ½é‡ã€‚\nè§¦åº•åå¼¹ä»èƒƒé‡Œå¼€å§‹ã€‚",
        accent:"linear-gradient(90deg, rgba(255,153,0,.26), rgba(29,116,255,.12))",
        ritual:"äº”åˆ†é’Ÿåªç®¡åƒï¼Œåˆ«ç®¡ä¸–ç•Œã€‚"
      },
      reward: { emoji:"ğŸ˜Œ", name:"æƒ³å¥–åŠ±è‡ªå·±",
        decide:"ç°åœ¨è¿™ç§æƒ…å†µï¼Œ\nç‚¹ä¸€ä»½æœ€â€œå€¼å¾—â€çš„ä¸œè¥¿ã€‚\nä½ å€¼å¾—æŠŠä»Šå¤©æ”¶å¥½ã€‚",
        accent:"linear-gradient(90deg, rgba(0,0,0,.10), rgba(255,153,0,.22))",
        ritual:"æ‰“å¼€ä½ æœ€çˆ±çš„æ­Œï¼ŒæŠŠè¿™ä¸€é¡¿å½“æˆå¥–æ¯ã€‚"
      },
      rush:   { emoji:"ğŸ•™", name:"èµ¶æ—¶é—´",
        decide:"ç°åœ¨è¿™ç§æƒ…å†µï¼Œ\né€‰æœ€å¿«ã€æœ€ç¨³çš„ä¸€é¤ã€‚\næ•ˆç‡ä¼˜å…ˆï¼Œåˆ«çº ç»“ã€‚",
        accent:"linear-gradient(90deg, rgba(29,116,255,.26), rgba(0,0,0,.08))",
        ritual:"å…ˆä¸‹å•ï¼šåƒä¸åƒå¾—ç²¾è‡´å…ˆåˆ«ç®¡ã€‚"
      },
      decide: { emoji:"ğŸ¤”", name:"ä½ æ¥å†³å®š",
        decide:"ç°åœ¨è¿™ç§æƒ…å†µï¼Œ\næ¥ä»½ä¸åã€ä¸åˆºæ¿€ã€ä¹Ÿä¸ç³Ÿç³•çš„ä¸€é¤ã€‚\nç¨³ä½å°±èµ¢ã€‚",
        accent:"linear-gradient(90deg, rgba(0,0,0,.06), rgba(29,116,255,.18))",
        ritual:"åƒå®Œå†åšä¸‹ä¸€ä»¶äº‹ã€‚"
      }
    };

    const HOME_BTNS = [
      { key:"tired",  hint:"çƒ­çš„ã€èƒ½é¡¶ä½" },
      { key:"sad",    hint:"ç†Ÿæ‚‰çš„é¥­ï¼Œç¨³ä¸€ä¸‹" },
      { key:"reward", hint:"ä»Šå¤©å€¼å¾—" },
      { key:"rush",   hint:"æœ€å¿«è§£å†³" },
      { key:"decide", hint:"æˆ‘æ¥æŒ‘ä¸€ä¸ªç¨³çš„" },
    ];

    /**********************
     * èœå•ï¼š114 ä¸ªï¼ˆfast 24 / noodle 24 / rice 24 / soft 16 / heavy 14 / sweet 12ï¼‰
     **********************/
    function toKW(label){
      return label
        .replace(/ï¼ˆ[^ï¼‰]*ï¼‰/g, "")
        .replace(/\s*\+\s*/g, " ")
        .replace(/\s+/g, " ")
        .trim();
    }
    function make(cat, labels){
      return labels.map((label, i)=>({
        id: cat.toUpperCase().slice(0,1) + String(i+1).padStart(2,"0") + "-" + cat,
        label,
        cat,
        kw: toKW(label)
      }));
    }

    // FAST 24ï¼ˆèµ¶æ—¶é—´å¼ºä¼˜å…ˆï¼‰
    const FAST = make("fast", [
      "éº¦è¾£é¸¡è…¿å ¡",
      "ç»å…¸ç‰›è‚‰æ±‰å ¡",
      "åŒå±‚èŠå£«ç‰›è‚‰å ¡",
      "é¸¡è‚‰æ±‰å ¡ï¼ˆä¸è¾£ï¼‰",
      "é¸¡è‚‰å·",
      "å¢¨è¥¿å“¥é¸¡è‚‰å·é¥¼",
      "çƒ¤ç‰›è‚‰å·",
      "é¦™çƒ¤ç‰›è‚‰ä¸‰æ˜æ²»",
      "ç«è…¿èŠå£«ä¸‰æ˜æ²»",
      "é‡‘æªé±¼ä¸‰æ˜æ²»",
      "ç…§çƒ§é¸¡è…¿ä¸‰æ˜æ²»",
      "Subway é¦™çƒ¤ç‰›è‚‰ 6å¯¸",
      "Subway é‡‘æªé±¼ 6å¯¸",
      "é¥­å›¢ï¼ˆç…§çƒ§é¸¡ï¼‰",
      "é¥­å›¢ï¼ˆé‡‘æªé±¼ï¼‰",
      "ä¾¿åˆ©åº—ä¾¿å½“ï¼ˆé¸¡æ’ï¼‰",
      "ä¾¿åˆ©åº—ä¾¿å½“ï¼ˆå¤è‚‰ï¼‰",
      "é¸¡æ’é¥­ï¼ˆå¿«å‡ºï¼‰",
      "å¤è‚‰é¥­ï¼ˆå¿«å‡ºï¼‰",
      "å’–å–±é¸¡é¥­ï¼ˆå¿«å‡ºï¼‰",
      "ç‚¸é¸¡å¥—é¤ï¼ˆå°ä»½ï¼‰",
      "è–¯æ¡ + é¥®æ–™ï¼ˆåº”æ€¥ï¼‰",
      "çƒ­ç‹—ï¼ˆç»å…¸ï¼‰",
      "æŠ«è¨ï¼ˆå•äººä»½ï¼‰"
    ]);

    // NOODLE 24ï¼ˆé¿å…â€œå…¨æ˜¯ç‰›è‚‰é¢â€ï¼‰
    const NOODLE = make("noodle", [
      "æ¸…æ±¤ç‰›è‚‰é¢",
      "çº¢çƒ§ç‰›è‚‰é¢",
      "ç‰›è…©é¢",
      "æ’éª¨æ±¤é¢",
      "é¸¡æ±¤é¢",
      "é…¸èœè‚‰ä¸é¢",
      "é›ªèœè‚‰ä¸é¢",
      "æ¦¨èœè‚‰ä¸é¢",
      "è‘±æ²¹æ‹Œé¢",
      "ç‚¸é…±é¢",
      "æ‹…æ‹…é¢ï¼ˆå¾®è¾£ï¼‰",
      "çƒ­å¹²é¢",
      "åˆ€å‰Šé¢ï¼ˆå¤è‚‰ï¼‰",
      "æ‹‰æ¡å­æ‹Œé¢",
      "ç‰›è‚‰æ‹Œé¢",
      "é¦„é¥¨é¢",
      "é²œè‚‰å°é¦„é¥¨ï¼ˆæ±¤ï¼‰",
      "é…¸è¾£ç²‰",
      "ç‰›è‚‰ç²‰ä¸æ±¤",
      "ç ‚é”…ç±³çº¿ï¼ˆé¸¡æ±¤ï¼‰",
      "è¿‡æ¡¥ç±³çº¿ï¼ˆç®€ç‰ˆï¼‰",
      "ä¹Œå†¬é¢ï¼ˆæ¸…æ±¤ï¼‰",
      "æ—¥å¼è±šéª¨æ‹‰é¢",
      "éŸ©å¼éƒ¨é˜Ÿé”…æ‹‰é¢ï¼ˆå°è¾£ï¼‰"
    ]);

    // RICE 24ï¼ˆä¸åšâ€œé£Ÿå ‚èœå•æ„Ÿâ€ï¼Œæ›´åƒå¤–å–ï¼‰
    const RICE = make("rice", [
      "é»„ç„–é¸¡ç±³é¥­",
      "å¤è‚‰é¥­",
      "ç…§çƒ§é¸¡è…¿é¥­",
      "å’–å–±é¸¡é¥­",
      "é»‘æ¤’ç‰›æŸ³é¥­",
      "ç•ªèŒ„ç‚’è›‹ç›–é¥­",
      "é’æ¤’é¸¡è›‹ç›–é¥­",
      "é±¼é¦™è‚‰ä¸ç›–é¥­",
      "å®«ä¿é¸¡ä¸ç›–é¥­",
      "éº»å©†è±†è…ç›–é¥­",
      "å›é”…è‚‰ç›–é¥­ï¼ˆå¾®è¾£ï¼‰",
      "æ¤’éº»é¸¡é¥­",
      "ä¸‰æ¯é¸¡ç›–é¥­",
      "è‚¥ç‰›é¥­ï¼ˆæ´‹è‘±ï¼‰",
      "çƒ¤è‚‰æ‹Œé¥­",
      "æ–°ç–†æŠ“é¥­ï¼ˆç‰›è‚‰ï¼‰",
      "é³—é±¼é¥­ï¼ˆç®€ç‰ˆï¼‰",
      "ç‰›ä¸¼ï¼ˆç®€ç‰ˆï¼‰",
      "éŸ©å¼æ‹Œé¥­ï¼ˆä¸è¾£ï¼‰",
      "çŸ³é”…æ‹Œé¥­ï¼ˆå¾®è¾£ï¼‰",
      "è›‹ç‚’é¥­ï¼ˆåŠ ç«è…¿ï¼‰",
      "æ‰¬å·ç‚’é¥­",
      "å’–å–±ç‰›è‚‰é¥­ï¼ˆå¾®è¾£ï¼‰",
      "çº¢çƒ§æ’éª¨é¥­"
    ]);

    // SOFT 16ï¼ˆç²¥/æ±¤/æ¢å¤ï¼‰
    const SOFT = make("soft", [
      "çš®è›‹ç˜¦è‚‰ç²¥",
      "é¸¡ä¸ç²¥",
      "å°ç±³ç²¥ + å°èœ",
      "ç™½ç²¥ + å’¸èœ",
      "å—ç“œç²¥",
      "æµ·é²œç²¥ï¼ˆç®€ç‰ˆï¼‰",
      "ç´«èœè›‹èŠ±æ±¤ + ç±³é¥­",
      "ç•ªèŒ„è›‹æ±¤ + ç±³é¥­",
      "èŒè‡é¸¡æ±¤",
      "å†¬ç“œæ’éª¨æ±¤",
      "ç•ªèŒ„ç‰›è…©æ±¤",
      "ç‰ç±³æ’éª¨æ±¤",
      "æ¸…ç‚–é¸¡æ±¤",
      "è’¸è›‹ç¾¹ + ç±³é¥­",
      "æ¸…æ±¤å°é¦„é¥¨",
      "ç‰›è‚‰æ¸…æ±¤ï¼ˆç²‰ä¸ï¼‰"
    ]);

    // HEAVY 14ï¼ˆå¥–åŠ±æ„Ÿï¼‰
    const HEAVY = make("heavy", [
      "éº»è¾£é¦™é”…ï¼ˆåŠ è‚‰ï¼‰",
      "çƒ¤è‚‰æ‹¼ç›˜",
      "çƒ§çƒ¤ç»„åˆï¼ˆè‚‰ä¸²ï¼‰",
      "ç«é”…å†’èœï¼ˆé‡æ»¡è¶³ï¼‰",
      "ç‚¸é¸¡æ¡¶ï¼ˆå°æ¡¶ï¼‰",
      "æŠ«è¨ï¼ˆåŒæ‹¼å¤§æ»¡è¶³ï¼‰",
      "ç‰›æ’é¥­ï¼ˆç®€ç‰ˆï¼‰",
      "é³—é±¼é¥­ï¼ˆåŠ é‡ï¼‰",
      "çº¢çƒ§æ’éª¨ + ç±³é¥­ï¼ˆåŠ é‡ï¼‰",
      "å›é”…è‚‰ + ç±³é¥­ï¼ˆåŠ é‡ï¼‰",
      "å¤§ç›˜é¸¡æ‹Œé¢ï¼ˆå°ä»½ï¼‰",
      "æ¤’éº»é¸¡ï¼ˆæ•´ä»½ï¼‰",
      "çƒ¤é±¼ï¼ˆç®€ç‰ˆï¼‰",
      "å¯¿å¸æ‹¼ç›˜ï¼ˆåŠ é‡ï¼‰"
    ]);

    // SWEET 12ï¼ˆä¸æ•·è¡ï¼‰
    const SWEET = make("sweet", [
      "å¥¶èŒ¶ï¼ˆç»å…¸ï¼‰",
      "å¥¶èŒ¶ï¼ˆä¹Œé¾™ï¼‰",
      "å¥¶ç›–èŒ¶",
      "æ¨æç”˜éœ²",
      "å†°æ·‡æ·‹ï¼ˆé¦™è‰ï¼‰",
      "å†°æ·‡æ·‹ï¼ˆå·§å…‹åŠ›ï¼‰",
      "ææ‹‰ç±³è‹",
      "èŠå£«è›‹ç³•",
      "å¸ƒä¸",
      "æ³¡èŠ™",
      "å¯ä¸½é¥¼",
      "æ‹¿é“ï¼ˆçƒ­ï¼‰"
    ]);

    const DISHES = [...FAST, ...NOODLE, ...RICE, ...SOFT, ...HEAVY, ...SWEET];

    const POOLS = {
      fast: FAST,
      noodle: NOODLE,
      rice: RICE,
      soft: SOFT,
      heavy: HEAVY,
      sweet: SWEET
    };

    /**********************
     * æƒé‡ï¼ˆä¸ä¹±æ”¹ä½ åŸæ„ï¼‰
     * é‡ç‚¹ï¼šrush å¼ºåˆ¶ä¼˜å…ˆ fastï¼ˆç¡¬è§„åˆ™ï¼‰
     **********************/
    const WEIGHTS = {
      tired:  { noodle: 44, soft: 28, rice: 22, fast: 6,  heavy: 0,  sweet: 0 },
      sad:    { rice:   38, noodle: 32, soft: 18, fast: 6,  heavy: 0,  sweet: 6 },
      reward: { heavy:  34, fast:  28, noodle: 18, rice: 12, soft: 0,  sweet: 8 },
      rush:   { fast:  100, rice: 0,  noodle: 0,  soft: 0,  heavy: 0,  sweet: 0 }, // âœ… å¼ºåˆ¶
      decide: { noodle: 40, rice:  34, soft: 20, fast: 6,  heavy: 0,  sweet: 0 },
    };

    function weightedPick(obj){
      const entries = Object.entries(obj).filter(([,w])=>w>0);
      const total = entries.reduce((s,[,w])=>s+w,0);
      let r = Math.random()*total;
      for(const [k,w] of entries){ r -= w; if(r<=0) return k; }
      return entries[entries.length-1][0];
    }
    function pickOne(arr, avoidId){
      if(!arr || arr.length===0) return null;
      if(!avoidId) return arr[Math.floor(Math.random()*arr.length)];
      const filtered = arr.filter(x=>x.id!==avoidId);
      const src = filtered.length ? filtered : arr;
      return src[Math.floor(Math.random()*src.length)];
    }

    // âœ… å…³é”®ï¼šrush ç›´æ¥ä» fast æŠ½ï¼›å…¶ä»–æŒ‰æƒé‡æŠ½
    function pickByMood(moodKey, lastId){
      if(moodKey === "rush"){
        return pickOne(POOLS.fast, lastId) || pickOne(DISHES, lastId);
      }
      const w = WEIGHTS[moodKey] || WEIGHTS.decide;
      const cat = weightedPick(w);
      return pickOne(POOLS[cat], lastId) || pickOne(DISHES, lastId);
    }

    /**********************
     * DOM
     **********************/
    const homeEl = document.getElementById("home");
    const resEl  = document.getElementById("result");
    const actionsEl = document.getElementById("actions");
    const topLeftEl = document.getElementById("topLeft");

    const gridEl = document.getElementById("grid");
    const backBtn = document.getElementById("backBtn");
    const goBtn = document.getElementById("goBtn");
    const swapBtn = document.getElementById("swapBtn");
    const changeBtn = document.getElementById("changeBtn");

    const accentBar = document.getElementById("accentBar");
    const stateTitle = document.getElementById("stateTitle");
    const stateDecide = document.getElementById("stateDecide");
    const dishText = document.getElementById("dishText");
    const dishMeta = document.getElementById("dishMeta");
    const ritualBox = document.getElementById("ritualBox");

    const toast = document.getElementById("toast");

    let currentMood = null;
    let currentDish = null;
    let lastDishId  = null;
    let jumpedOut   = false;

    function showToast(msg){
      toast.textContent = msg;
      toast.classList.add("show");
      clearTimeout(showToast._t);
      showToast._t = setTimeout(()=>toast.classList.remove("show"), 1400);
    }

    function setView(view){
      const isHome = view === "home";
      homeEl.style.display = isHome ? "flex" : "none";
      resEl.classList.toggle("active", !isHome);
      actionsEl.classList.toggle("active", !isHome);
      topLeftEl.style.display = isHome ? "none" : "block";
    }

    function renderResult(){
      const ui = STATE_UI[currentMood] || STATE_UI.decide;
      accentBar.style.background = ui.accent;
      stateTitle.textContent = `${ui.emoji} ${ui.name}`;
      stateDecide.textContent = ui.decide;

      dishText.textContent = currentDish?.label || "â€”";
      dishMeta.textContent = currentDish ? `å…³é”®è¯ï¼š${currentDish.kw}` : "â€”";
      ritualBox.innerHTML = `<b>ä»ªå¼æ„Ÿï¼ˆå¯é€‰ï¼‰</b>${ui.ritual}`;

      setView("result");
    }

    function pickMood(key){
      currentMood = key;
      currentDish = pickByMood(currentMood, lastDishId);
      lastDishId = currentDish?.id || null;
      renderResult();
    }

    function swapDish(){
      currentDish = pickByMood(currentMood || "decide", lastDishId);
      lastDishId = currentDish?.id || null;

      dishText.style.opacity = "0";
      dishMeta.style.opacity = "0";
      setTimeout(()=>{
        dishText.textContent = currentDish?.label || "â€”";
        dishMeta.textContent = currentDish ? `å…³é”®è¯ï¼š${currentDish.kw}` : "â€”";
        dishText.style.opacity = "1";
        dishMeta.style.opacity = "1";
      }, 90);
    }

    // âœ… ä¸€æ¬¡ç‚¹å‡»ï¼šç›´æ¥å”¤é†’ç¾å›¢ï¼ˆä¸ç¡®è®¤ã€ä¸ç½‘é¡µã€ä¸å¼‚æ­¥ï¼‰
    function goWaimai(){
      const kw = (currentDish?.kw || currentDish?.label || "").trim();
      if(!kw){
        showToast("å…ˆé€‰ä¸€ä¸ªå†å»ç‚¹å¤–å–ğŸ™‚");
        return;
      }
      jumpedOut = true;
      const url = "meituanwaimai://waimai.meituan.com/search?query=" + encodeURIComponent(kw);
      window.location.href = url;
    }

    document.addEventListener("visibilitychange", ()=>{
      if(document.visibilityState === "visible" && jumpedOut){
        jumpedOut = false;
        showToast(Math.random() < 0.5 ? "å¤šåƒç‚¹ğŸ™‚" : "åƒé¥±äº†å°±å¼€å¿ƒå•¦âœ¨");
      }
    });

    /**********************
     * ç»‘å®šï¼ˆå…¨éƒ¨ç”¨ tapï¼‰
     **********************/
    bindTap(backBtn, ()=> setView("home"));
    bindTap(changeBtn, ()=> setView("home"));
    bindTap(swapBtn, swapDish);
    bindTap(goBtn, goWaimai);

    function buildHome(){
      gridEl.innerHTML = "";
      HOME_BTNS.forEach(({key, hint})=>{
        const ui = STATE_UI[key];
        const btn = document.createElement("div");
        btn.className = "stateBtn";
        btn.innerHTML = `
          <div class="emojiCircle">${ui.emoji}</div>
          <div class="stateText">
            <div class="stateName">${ui.name}</div>
            <div class="stateHint">${hint}</div>
          </div>
        `;
        bindTap(btn, ()=> pickMood(key));
        gridEl.appendChild(btn);
      });
    }

    buildHome();
    setView("home");
  </script>
</body>
</html>
