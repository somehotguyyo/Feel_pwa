<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>feel Â· é€‰ä½ çš„é¥­</title>
<link rel="manifest" href="manifest.webmanifest">
<meta name="theme-color" content="#F5F5F7">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="default">
<meta name="apple-mobile-web-app-title" content="feel">
<link rel="apple-touch-icon" href="icons/icon-192.png">
  <style>
    :root{
      --bg:#f5f5f7;
      --card:rgba(255,255,255,.92);
      --stroke:rgba(0,0,0,.08);
      --text:#111;
      --muted:#6e6e73;
      --shadow:0 10px 30px rgba(0,0,0,.08);
      --shadow2:0 2px 10px rgba(0,0,0,.06);
      --radius:24px;
      --pad:18px;
      --ease:cubic-bezier(.2,.9,.2,1);
    }

    *{box-sizing:border-box}
    body{
      margin:0;
      background:var(--bg);
      color:var(--text);
      font-family:-apple-system,BlinkMacSystemFont,"SF Pro Display","SF Pro Text",
        "PingFang SC","Hiragino Sans GB","Microsoft YaHei","Segoe UI",Roboto,Arial,sans-serif;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
      overflow-x:hidden;
    }

    /* Subtle moving background (very light) */
    .bgGlow{
      position:fixed; inset:-40vh -30vw auto -30vw;
      height:80vh;
      background:
        radial-gradient(closest-side, rgba(0,0,0,.06), rgba(0,0,0,0)),
        radial-gradient(closest-side, rgba(0,0,0,.04), rgba(0,0,0,0));
      filter: blur(22px);
      opacity:.55;
      pointer-events:none;
      transform: translate3d(0,0,0);
      animation: floatGlow 10s var(--ease) infinite alternate;
    }
    @keyframes floatGlow{
      0%{ transform: translate3d(-2%, -2%, 0) }
      100%{ transform: translate3d(2%, 2%, 0) }
    }

    .wrap{
      max-width:860px;
      margin:0 auto;
      padding:24px var(--pad) 118px;
      position:relative;
    }

    /* Header */
    .header{
      margin-bottom: 10px;
      animation: fadeUp .55s var(--ease) both;
    }

    /* Handwritten title font stack (iOS friendly) */
    .title{
      margin:0;
      font-size:26px;
      line-height:1.05;
      letter-spacing:-0.01em;
      font-weight:700;
      font-family:
        "Snell Roundhand","Bradley Hand","Apple Chancery",
        "Comic Sans MS", /* last resort */
        cursive;
    }

    /* Make the rest feel crisp & â€œtool-likeâ€ */
    .sub{
      margin-top:10px;
      font-size:15px;
      color:var(--muted);
      line-height:1.55;
      letter-spacing:-0.01em;
      font-weight:520;
      animation: fadeUp .55s var(--ease) .06s both;
    }

    /* Home grid */
    .homeGrid{
      margin-top:18px;
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:16px;
    }
    /* Make the last card centered if odd count */
    .homeGrid .stateBtn:last-child{
      grid-column: 1 / -1;
      max-width: 420px;
      justify-self:center;
      width: 100%;
    }

    .stateBtn{
      border:1px solid rgba(255,255,255,.55);
      background:var(--card);
      border-radius:var(--radius);
      padding:18px 14px 16px;
      display:flex;
      flex-direction:column;
      align-items:center;
      gap:10px;
      box-shadow: var(--shadow2);
      backdrop-filter: blur(16px) saturate(180%);
      -webkit-backdrop-filter: blur(16px) saturate(180%);
      transform: translateY(14px);
      opacity:0;
      animation: popIn .55s var(--ease) both;
      transition: transform .18s var(--ease), box-shadow .18s var(--ease), filter .18s var(--ease), opacity .18s var(--ease);
      will-change: transform;
    }
    .stateBtn:nth-child(1){ animation-delay:.06s }
    .stateBtn:nth-child(2){ animation-delay:.10s }
    .stateBtn:nth-child(3){ animation-delay:.14s }
    .stateBtn:nth-child(4){ animation-delay:.18s }
    .stateBtn:nth-child(5){ animation-delay:.22s }

    @keyframes popIn{
      0%{ transform: translateY(14px); opacity:0 }
      100%{ transform: translateY(0); opacity:1 }
    }
    @keyframes fadeUp{
      0%{ transform: translateY(10px); opacity:0 }
      100%{ transform: translateY(0); opacity:1 }
    }

    /* Press feels like iOS: lift, not shrink */
    .stateBtn:active{
      transform: translateY(-2px);
      box-shadow: 0 14px 34px rgba(0,0,0,.12);
      filter: saturate(1.05);
    }

    .iconCircle{
      width:58px; height:58px; border-radius:999px;
      display:flex; align-items:center; justify-content:center;
      font-size:26px;
      background: rgba(0,0,0,.04);
      border: 1px solid rgba(0,0,0,.04);
      box-shadow: inset 0 1px 0 rgba(255,255,255,.9);
      position:relative;
      overflow:hidden;
    }
    /* Tiny shine sweep on icons (subtle) */
    .iconCircle::after{
      content:"";
      position:absolute; inset:-40% -60%;
      background: linear-gradient(120deg, rgba(255,255,255,0), rgba(255,255,255,.55), rgba(255,255,255,0));
      transform: translateX(-40%) rotate(8deg);
      opacity:.35;
      animation: sweep 3.8s var(--ease) infinite;
    }
    @keyframes sweep{
      0%,55%{ transform: translateX(-55%) rotate(8deg); opacity:0 }
      70%{ opacity:.32 }
      100%{ transform: translateX(45%) rotate(8deg); opacity:0 }
    }

    /* Card text font: softer but still modern */
    .stateText{
      font-size:14.5px;
      font-weight:650;
      letter-spacing:-0.01em;
      color: rgba(0,0,0,.86);
      font-family:
        -apple-system,BlinkMacSystemFont,
        "SF Pro Display","SF Pro Text",
        "PingFang SC","Hiragino Sans GB","Microsoft YaHei",
        "Segoe UI",Roboto,Arial,sans-serif;
    }

    .hint{
      margin-top:14px;
      font-size:12px;
      color: rgba(0,0,0,.40);
      line-height:1.45;
      animation: fadeUp .55s var(--ease) .14s both;
    }

    /* Result */
    .navRow{
      display:flex;
      gap:10px;
      margin: 4px 0 12px;
      animation: fadeUp .45s var(--ease) both;
    }
    .pill{
      border:1px solid rgba(0,0,0,.10);
      background: rgba(255,255,255,.75);
      backdrop-filter: blur(16px) saturate(180%);
      -webkit-backdrop-filter: blur(16px) saturate(180%);
      border-radius:999px;
      padding:10px 12px;
      font-size:13px;
      font-weight:700;
      color: rgba(0,0,0,.75);
      transition: transform .12s var(--ease);
    }
    .pill:active{ transform: translateY(-1px); }

    .card{
      border: 1px solid rgba(255,255,255,.55);
      background: var(--card);
      border-radius: 28px;
      padding: 18px;
      box-shadow: var(--shadow);
      backdrop-filter: blur(18px) saturate(180%);
      -webkit-backdrop-filter: blur(18px) saturate(180%);
      transform-origin: 50% 10%;
      animation: cardIn .55s var(--ease) both;
    }
    @keyframes cardIn{
      0%{ transform: translateY(14px) scale(.99); opacity:0 }
      100%{ transform: translateY(0) scale(1); opacity:1 }
    }

    .accent{
      height:10px; border-radius:999px;
      background: linear-gradient(90deg, rgba(0,0,0,.15), rgba(0,0,0,0));
      margin-bottom: 14px;
      position:relative;
      overflow:hidden;
    }
    /* Accent shimmer */
    .accent::after{
      content:"";
      position:absolute; inset:0;
      background: linear-gradient(90deg, rgba(255,255,255,0), rgba(255,255,255,.55), rgba(255,255,255,0));
      transform: translateX(-60%);
      opacity:.22;
      animation: accentSweep 2.6s var(--ease) infinite;
    }
    @keyframes accentSweep{
      0%,55%{ transform: translateX(-65%); opacity:0 }
      75%{ opacity:.22 }
      100%{ transform: translateX(65%); opacity:0 }
    }

    .stateTitle{
      font-size:22px;
      font-weight:850;
      letter-spacing:-0.02em;
      margin: 4px 0 10px;
    }

    .decide{
      white-space: pre-line;
      font-size: 17px;
      line-height: 1.7;
      letter-spacing: -0.01em;
      color: rgba(0,0,0,.86);
    }

    .divider{
      height:1px;
      background: rgba(0,0,0,.08);
      margin: 16px 0;
    }

    .label{
      font-size: 12px;
      color: rgba(0,0,0,.50);
      font-weight: 850;
      letter-spacing: .16em;
      text-transform: uppercase;
    }

    .pick{
      margin-top: 10px;
      font-size: 22px;
      font-weight: 850;
      letter-spacing: -0.02em;
      line-height: 1.25;
      animation: fadeUp .35s var(--ease) both;
    }

    .meta{
      margin-top: 8px;
      font-size: 13px;
      color: rgba(0,0,0,.55);
      line-height: 1.5;
      animation: fadeUp .35s var(--ease) .04s both;
    }

    .module{
      margin-top: 14px;
      padding: 14px;
      border-radius: 18px;
      background: rgba(0,0,0,.04);
      border: 1px solid rgba(0,0,0,.05);
      animation: fadeUp .35s var(--ease) .06s both;
    }
    .moduleTitle{
      font-size: 12px;
      color: rgba(0,0,0,.50);
      font-weight: 850;
      letter-spacing: .12em;
      text-transform: uppercase;
    }
    .moduleBody{
      margin-top: 8px;
      font-size: 14px;
      color: rgba(0,0,0,.82);
      line-height: 1.55;
      font-weight: 650;
      letter-spacing: -0.01em;
    }

    /* Sticky action bar */
    .sticky{
      position:fixed; left:0; right:0; bottom:0;
      padding: 10px 12px 12px;
      border-top:1px solid rgba(0,0,0,.08);
      background: rgba(245,245,247,.78);
      backdrop-filter: blur(18px) saturate(180%);
      -webkit-backdrop-filter: blur(18px) saturate(180%);
    }
    .stickyInner{
      max-width:860px;
      margin:0 auto;
      display:flex;
      gap: 10px;
      flex-wrap:wrap;
      padding: 0 var(--pad);
    }

    .action{
      border-radius: 999px;
      padding: 12px 14px;
      font-size: 14px;
      font-weight: 850;
      border: 1px solid rgba(0,0,0,.10);
      background: rgba(255,255,255,.85);
      box-shadow: 0 2px 10px rgba(0,0,0,.06);
      transition: transform .12s var(--ease), box-shadow .12s var(--ease);
    }
    .action:active{
      transform: translateY(-1px);
      box-shadow: 0 10px 20px rgba(0,0,0,.10);
    }
    .action.primary{
      border-color: rgba(0,0,0,.88);
      background: rgba(0,0,0,.92);
      color:#fff;
      box-shadow: 0 10px 26px rgba(0,0,0,.20);
    }
    .action.ghost{
      background: rgba(255,255,255,.72);
      color: rgba(0,0,0,.78);
    }

    /* Selection focus effect: when choosing a state, others fade slightly */
    .dimmed{ opacity:.60; }

    /* Respect reduced motion */
    @media (prefers-reduced-motion: reduce){
      .bgGlow, .iconCircle::after, .accent::after { animation: none !important; }
      .stateBtn, .header, .sub, .hint, .card, .pick, .meta, .module, .navRow { animation: none !important; opacity:1 !important; transform:none !important; }
      .stateBtn:active, .pill:active, .action:active { transform:none !important; }
    }
  </style>
</head>

<body>
  <div class="bgGlow"></div>

  <div class="wrap">
    <!-- HOME -->
    <section id="home">
      <div class="header">
        <h1 class="title">è¯´ä½ çš„ feelï¼Œé€‰ä½ çš„é¥­</h1>
        <div class="sub">ä¸ç”¨æƒ³ã€‚æˆ‘æ›¿ä½ åšä¸€ä¸ªä¸åæ‚”çš„å†³å®šã€‚</div>
      </div>

      <div class="homeGrid">
        <button class="stateBtn" data-state="tired">
          <div class="iconCircle">ğŸ˜®â€ğŸ’¨</div>
          <div class="stateText">ç´¯</div>
        </button>

        <button class="stateBtn" data-state="sad">
          <div class="iconCircle">â˜¹ï¸</div>
          <div class="stateText">å¿ƒæƒ…ä¸å¥½</div>
        </button>

        <button class="stateBtn" data-state="reward">
          <div class="iconCircle">ğŸ˜Œ</div>
          <div class="stateText">æƒ³å¥–åŠ±è‡ªå·±</div>
        </button>

        <button class="stateBtn" data-state="rush">
          <div class="iconCircle">ğŸ•™</div>
          <div class="stateText">èµ¶æ—¶é—´</div>
        </button>

        <button class="stateBtn" data-state="decide">
          <div class="iconCircle">ğŸ¤”</div>
          <div class="stateText">ä½ æ¥å†³å®š</div>
        </button>
      </div>

      <div class="hint">V1ï¼šå…ˆæŠŠâ€œå†³å®šâ€å’Œâ€œå¯ä¿¡åº¦â€åšå¯¹ï¼›èªæ˜å’Œä¸ªæ€§åŒ–ç•™åˆ°åæœŸã€‚</div>
    </section>

    <!-- RESULT -->
    <section id="result" style="display:none;">
      <div class="navRow">
        <button class="pill" id="homeBtn">â† å›é¦–é¡µ</button>
      </div>

      <div class="card" id="resultCard">
        <div class="accent" id="accentBar"></div>

        <div class="stateTitle" id="stateTitle"></div>
        <div class="decide" id="decideText"></div>

        <div class="divider"></div>

        <div class="label">ä»Šå¤©å°±ç‚¹è¿™ä¸ª</div>
        <div class="pick" id="pickText"></div>
        <div class="meta" id="pickMeta"></div>

        <div class="module">
          <div class="moduleTitle" id="moduleTitle"></div>
          <div class="moduleBody" id="moduleBody"></div>
        </div>
      </div>
    </section>
  </div>

  <!-- Sticky action bar -->
  <div class="sticky" id="stickyBar" style="display:none;">
    <div class="stickyInner">
      <button class="action primary" id="goBtn">å»ç‚¹å¤–å–</button>
      <button class="action" id="swapBtn">æ¢ä¸€ä¸ª</button>
      <button class="action ghost" id="againBtn">æ¢ä¸ªçŠ¶æ€</button>
    </div>
  </div>

<script>
/* =========================
   D: èœå“æ•°æ®ï¼ˆ60ï¼‰
   è¯´æ˜ï¼š
   - labelï¼šå±•ç¤ºæ–‡æ¡ˆ
   - kwï¼šè·³ç¾å›¢æœç´¢å…³é”®è¯ï¼ˆå°½é‡çŸ­ã€å‘½ä¸­é«˜ï¼›æ‹¬å·å†…å®¹ä¼šè¢«å»æ‰ï¼‰
   - catï¼šç±»åˆ«ï¼ˆnoodle/rice/soft/fast/heavy/sweetï¼‰
   ========================= */

function toKW(label){
  // å»æ‰æ‹¬å·å†…å®¹ã€å»æ‰â€œ+â€ã€å»æ‰å¤šä½™ç©ºæ ¼ï¼›ä¿ç•™æ ¸å¿ƒå…³é”®è¯
  return label
    .replace(/ï¼ˆ[^ï¼‰]*ï¼‰/g, "")
    .replace(/\s*\+\s*/g, " ")
    .replace(/\s+/g, " ")
    .trim();
}

const DISHES = [
  // ğŸœ noodle 18
  { id:"N01", label:"æ¸…æ±¤ç‰›è‚‰é¢", cat:"noodle" },
  { id:"N02", label:"çº¢çƒ§ç‰›è‚‰é¢", cat:"noodle" },
  { id:"N03", label:"ç‰›è…©é¢", cat:"noodle" },
  { id:"N04", label:"æ’éª¨æ±¤é¢", cat:"noodle" },
  { id:"N05", label:"é¸¡æ±¤é¢", cat:"noodle" },
  { id:"N06", label:"é…¸èœè‚‰ä¸é¢", cat:"noodle" },
  { id:"N07", label:"é¦„é¥¨é¢", cat:"noodle" },
  { id:"N08", label:"æ—¥å¼è±šéª¨æ‹‰é¢", cat:"noodle" },
  { id:"N09", label:"æµ·é²œæ±¤é¢", cat:"noodle" },
  { id:"N10", label:"æ¸…æ±¤é¸¡ä¸é¢", cat:"noodle" },
  { id:"N11", label:"ç‚¸é…±é¢", cat:"noodle" },
  { id:"N12", label:"è‘±æ²¹æ‹Œé¢", cat:"noodle" },
  { id:"N13", label:"è¿‡æ²¹è‚‰æ‹Œé¢", cat:"noodle" },
  { id:"N14", label:"æ‹…æ‹…é¢", cat:"noodle" },
  { id:"N15", label:"ç‰›è‚‰æ‹Œé¢", cat:"noodle" },
  { id:"N16", label:"ç‰›è‚‰ç²‰ä¸æ±¤", cat:"noodle" },
  { id:"N17", label:"é…¸è¾£ç²‰", cat:"noodle" },
  { id:"N18", label:"å¹¿å¼ç‚’æ²³ç²‰", cat:"noodle" },

  // ğŸš rice 15
  { id:"R19", label:"é¸¡ä¸ + ç±³é¥­ï¼ˆä¸è¾£ï¼‰", cat:"rice" },
  { id:"R20", label:"ç•ªèŒ„ç‚’è›‹ + ç±³é¥­", cat:"rice" },
  { id:"R21", label:"é’æ¤’é¸¡è›‹ + ç±³é¥­", cat:"rice" },
  { id:"R22", label:"è±†è…ç‰›è‚‰ + ç±³é¥­ï¼ˆå¾®è¾£ï¼‰", cat:"rice" },
  { id:"R23", label:"é¸¡ä¸ + ç±³é¥­ï¼ˆå¾®è¾£ï¼‰", cat:"rice" },
  { id:"R24", label:"é…¸ç”œå£è‚‰ä¸ + ç±³é¥­", cat:"rice" },
  { id:"R25", label:"çº¢çƒ§ç‰›è‚‰ + ç±³é¥­ï¼ˆå¤šè‚‰ï¼‰", cat:"rice" },
  { id:"R26", label:"é»‘æ¤’ç‰›æŸ³ + ç±³é¥­", cat:"rice" },
  { id:"R27", label:"å’–å–±é¸¡ + ç±³é¥­", cat:"rice" },
  { id:"R28", label:"ç™½åˆ‡é¸¡ + ç±³é¥­ï¼ˆä¸æ²¹ä¸è¾£ï¼‰", cat:"rice" },
  { id:"R29", label:"æ¸…è’¸é±¼ + ç±³é¥­", cat:"rice" },
  { id:"R30", label:"é¸¡ä¸è”¬èœ + ç±³é¥­", cat:"rice" },
  { id:"R31", label:"æ–°ç–†æŠ“é¥­ï¼ˆç‰›è‚‰ï¼‰", cat:"rice" },
  { id:"R32", label:"ç…§çƒ§é¸¡è…¿ + ç±³é¥­", cat:"rice" },
  { id:"R33", label:"é»„ç„–é¸¡ + ç±³é¥­ï¼ˆåé‡å£ï¼‰", cat:"rice" },

  // ğŸ² soft 9ï¼ˆç²¥/æ±¤/è½¯é£Ÿï¼‰
  { id:"S34", label:"çš®è›‹ç˜¦è‚‰ç²¥ï¼ˆçƒ­çš„ï¼‰", cat:"soft" },
  { id:"S35", label:"é¸¡ä¸ç²¥", cat:"soft" },
  { id:"S36", label:"å°ç±³ç²¥ + å°èœ", cat:"soft" },
  { id:"S37", label:"ç™½ç²¥ + å’¸èœ", cat:"soft" },
  { id:"S38", label:"å—ç“œç²¥", cat:"soft" },
  { id:"S39", label:"æ’éª¨æ±¤ + ç±³é¥­", cat:"soft" },
  { id:"S40", label:"ç•ªèŒ„ç‰›è…©æ±¤", cat:"soft" },
  { id:"S41", label:"ç´«èœè›‹èŠ±æ±¤ + ç±³é¥­", cat:"soft" },
  { id:"S42", label:"å†¬ç“œæ’éª¨æ±¤", cat:"soft" },

  // ğŸ” fast 9ï¼ˆå»é‡å¤ç‰ˆï¼‰
  { id:"F43", label:"ç»å…¸ç‰›è‚‰æ±‰å ¡", cat:"fast" },
  { id:"F44", label:"é¸¡è‚‰å·", cat:"fast" },
  { id:"F45", label:"ç«è…¿èŠå£«ä¸‰æ˜æ²»", cat:"fast" },
  { id:"F46", label:"é¦™çƒ¤ç‰›è‚‰ä¸‰æ˜æ²»ï¼ˆçƒ­ï¼‰", cat:"fast" },
  { id:"F47", label:"å¢¨è¥¿å“¥é¸¡è‚‰å·é¥¼", cat:"fast" },
  { id:"F48", label:"æŠ«è¨ï¼ˆå•äººä»½ï¼‰", cat:"fast" },
  { id:"F49", label:"ç‚¸é¸¡å¥—é¤", cat:"fast" },
  // æ³¨æ„ï¼šç‚¸çŒªæ’å¥—é¤æˆ‘ä»¬å½’åˆ° heavyï¼ˆé‡é¤ï¼‰ï¼Œfast é‡Œä¸å†å•ç‹¬é‡å¤
  { id:"F51", label:"è–¯æ¡ + é¥®æ–™ï¼ˆåº”æ€¥ï¼‰", cat:"fast" },

  // ğŸ– heavy 6ï¼ˆé‡é¤ï¼‰
  { id:"H52", label:"çº¢çƒ§æ’éª¨", cat:"heavy" },
  { id:"H53", label:"å›é”…è‚‰ + ç±³é¥­", cat:"heavy" },
  { id:"H54", label:"çƒ¤è‚‰æ‹Œé¥­", cat:"heavy" },
  { id:"H55", label:"éº»è¾£é¦™é”…", cat:"heavy" },
  { id:"H56", label:"çƒ§çƒ¤æ‹¼ç›˜", cat:"heavy" },
  { id:"H57", label:"ç‚¸çŒªæ’å¥—é¤", cat:"heavy" },

  // ğŸ° sweet 3
  { id:"T58", label:"å¥¶èŒ¶", cat:"sweet" },
  { id:"T59", label:"ææ‹‰ç±³è‹", cat:"sweet" },
  { id:"T60", label:"å†°æ·‡æ·‹", cat:"sweet" },
].map(d => ({ ...d, kw: toKW(d.label) }));

const POOLS = {
  noodle: DISHES.filter(d=>d.cat==="noodle"),
  rice:   DISHES.filter(d=>d.cat==="rice"),
  soft:   DISHES.filter(d=>d.cat==="soft"),
  fast:   DISHES.filter(d=>d.cat==="fast"),
  heavy:  DISHES.filter(d=>d.cat==="heavy"),
  sweet:  DISHES.filter(d=>d.cat==="sweet"),
};

/* =========================
   F: æƒ…ç»ª -> ç±»åˆ«æƒé‡
   moodKey ç”¨ä½ é¡µé¢çš„çŠ¶æ€ keyï¼ˆä¾‹å¦‚ tired/sad/reward/rush/decideï¼‰
   è§„åˆ™ï¼šåªå†³å®šâ€œå…ˆæŠ½å“ªä¸ªç±»åˆ«â€ï¼Œå†ä»ç±»åˆ«æ± é‡ŒéšæœºæŠ½ä¸€ä¸ªèœ
   ========================= */

const WEIGHTS = {
  // ğŸ˜®â€ğŸ’¨ç´¯ï¼šçƒ­çš„ã€è½¯çš„ä¼˜å…ˆï¼›å¿«é¤å°‘ä¸€ç‚¹ï¼›åŸºæœ¬ä¸å‡ºç”œç‚¹
  tired:  { noodle: 42, soft: 30, rice: 22, fast: 6,  heavy: 0,  sweet: 0 },

  // â˜¹ï¸å¿ƒæƒ…ä¸å¥½ï¼šç†Ÿæ‚‰ä¸»é£Ÿä¼˜å…ˆï¼Œå…è®¸ä¸€ç‚¹ç”œ
  sad:    { rice:   38, noodle: 32, soft: 18, fast: 6,  heavy: 0,  sweet: 6 },

  // ğŸ˜Œå¥–åŠ±è‡ªå·±ï¼šé‡é¤/å¿«é¤æå‡ï¼Œç”œç‚¹å…è®¸
  reward: { heavy:  34, fast:  28, noodle: 18, rice: 12, soft: 0,  sweet: 8 },

  // ğŸ•™èµ¶æ—¶é—´ï¼šå¿«é¤/å›ºå®šé¥­ä¼˜å…ˆï¼Œè½¯é£Ÿå°‘é‡å…œåº•
  rush:   { fast:   52, rice:  28, noodle: 12, soft: 8,  heavy: 0,  sweet: 0 },

  // ğŸ¤”ä½ æ¥å†³å®šï¼šç¨³å¦¥ä¸ºä¸»ï¼Œè‡ªåŠ¨é¿å¼€ heavyï¼›ç”œç‚¹ä¸ä¸»åŠ¨å‡º
  decide: { noodle: 40, rice:  34, soft: 20, fast: 6,  heavy: 0,  sweet: 0 },
};

function weightedPick(obj){
  const entries = Object.entries(obj).filter(([,w]) => w > 0);
  const total = entries.reduce((s,[,w])=>s+w,0);
  let r = Math.random() * total;
  for(const [k,w] of entries){
    r -= w;
    if(r <= 0) return k;
  }
  return entries[entries.length-1][0];
}

function pickOne(arr, avoidId){
  if(!arr || arr.length===0) return null;
  if(!avoidId) return arr[Math.floor(Math.random()*arr.length)];
  const filtered = arr.filter(x=>x.id!==avoidId);
  return (filtered.length ? filtered : arr)[Math.floor(Math.random()*(filtered.length?filtered.length:arr.length))];
}

/**
 * è¿”å›ä¸€ä¸ªèœå¯¹è±¡ï¼š{id,label,kw,cat}
 * å¯ä¼  lastId è®©â€œæ¢ä¸€ä¸ªâ€å°½é‡ä¸é‡å¤
 */
function pickByMood(moodKey, lastId){
  const w = WEIGHTS[moodKey] || WEIGHTS.decide;
  const cat = weightedPick(w);
  const dish = pickOne(POOLS[cat], lastId);
  return dish || pickOne(DISHES, lastId);
}

  function timeBucket(){
    const h = new Date().getHours();
    if (h >= 7 && h < 14) return "rush";
    if (h >= 14 && h < 21) return "tired";
    return "sad";
  }

  function picksFor(stateKey){
    if(stateKey !== "decide") return DATA[stateKey].picks;
    const bucket = timeBucket();
    const b = DATA[bucket].picks;
    return [
      { dish: b[0].dish, why: `æŒ‰å½“å‰æ—¶é—´ï¼šèµ°ã€Œ${DATA[bucket].title}ã€å…¬å¼ï¼ˆæœ€ä¸å®¹æ˜“åæ‚”ï¼‰ã€‚`, kw: b[0].kw },
      { dish: DATA.tired.picks[1].dish, why: "åæ¢å¤ï¼šæ›´ç¨³ã€æ›´å®¹æ˜“åƒä¸‹å»ã€‚", kw: DATA.tired.picks[1].kw },
      { dish: DATA.rush.picks[0].dish, why: "åæ•ˆç‡ï¼šæœ€å¿«æ‹¿åˆ°ã€æœ€å°‘å˜é‡ã€‚", kw: DATA.rush.picks[0].kw },
    ];
  }

  const homeEl = document.getElementById('home');
  const resEl  = document.getElementById('result');
  const stickyBar = document.getElementById('stickyBar');

  const accentBar  = document.getElementById('accentBar');
  const stateTitle = document.getElementById('stateTitle');
  const decideText = document.getElementById('decideText');
  const pickText   = document.getElementById('pickText');
  const pickMeta   = document.getElementById('pickMeta');

  const moduleTitle = document.getElementById('moduleTitle');
  const moduleBody  = document.getElementById('moduleBody');

  const homeBtn = document.getElementById('homeBtn');
  const goBtn   = document.getElementById('goBtn');
  const swapBtn = document.getElementById('swapBtn');
  const againBtn= document.getElementById('againBtn');

  let currentState = null;
  let idx = 0;

  function showHome(){
    resEl.style.display  = "none";
    stickyBar.style.display = "none";
    homeEl.style.display = "block";
    currentState = null;
    idx = 0;

    // reset any dimming
    document.querySelectorAll('.stateBtn').forEach(b => b.classList.remove('dimmed'));
  }

  function animateSwap(){
    // small â€œsoftâ€ transition on pick change
    pickText.style.opacity = 0;
    pickMeta.style.opacity = 0;
    setTimeout(()=>{
      pickText.style.opacity = 1;
      pickMeta.style.opacity = 1;
    }, 90);
  }

  function render(stateKey, chosenBtn){
    currentState = stateKey;
    idx = 0;

    const S = DATA[stateKey];
    const picks = picksFor(stateKey);

    // dim others a bit right when you choose (feels â€œaliveâ€)
    document.querySelectorAll('.stateBtn').forEach(b=>{
      if(chosenBtn && b !== chosenBtn) b.classList.add('dimmed');
    });

    accentBar.style.background = S.accent || "linear-gradient(90deg, rgba(0,0,0,.14), rgba(0,0,0,0))";
    stateTitle.textContent = S.title;
    decideText.textContent = S.decide;

    pickText.textContent = picks[idx].dish;
    pickMeta.textContent = picks[idx].why;

    moduleTitle.textContent = S.moduleTitle || "";
    moduleBody.textContent  = S.moduleBody || "";

    homeEl.style.display = "none";
    resEl.style.display  = "block";
    stickyBar.style.display = "block";
    animateSwap();
    window.scrollTo({top:0, behavior:"smooth"});
  }

  function swap(){
    const picks = picksFor(currentState);
    idx = (idx + 1) % picks.length;
    pickText.textContent = picks[idx].dish;
    pickMeta.textContent = picks[idx].why;
    animateSwap();
  }

  // âœ… ä¿ç•™â€œå°è¯•å”¤é†’ç¾å›¢ App + å¤±è´¥å›é€€ç½‘é¡µæœç´¢â€
  function go(){
    const picks = picksFor(currentState);
    const kw = picks[idx].kw || picks[idx].dish;

    const appUrl = "meituanwaimai://waimai.meituan.com/search?query=" + encodeURIComponent(kw);
    const webUrl = "https://waimai.meituan.com/search?keyword=" + encodeURIComponent(kw);

    const start = Date.now();
    window.location.href = appUrl;

    setTimeout(() => {
      if (Date.now() - start < 1400) {
        window.open(webUrl, "_blank");
      }
    }, 900);
  }

  document.querySelectorAll('.stateBtn').forEach(b=>{
    b.addEventListener('click', ()=>render(b.dataset.state, b));
  });

  homeBtn.addEventListener('click', showHome);
  againBtn.addEventListener('click', showHome);
  swapBtn.addEventListener('click', swap);
  goBtn.addEventListener('click', go);
</script>
</body>
</html>
